<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>/api/setting/setEmoji - Siyuan Kernel API</title>
    <link rel="stylesheet" href="../style.min.css?20231218">
    <link rel="icon" type="image/png" href="../favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../favicon-16x16.png" sizes="16x16">
</head>
<body>
<div class="markdown-body">
    <h1>/api/setting/setEmoji</h1>
    <p>è®¾ç½®ç¼–è¾‘å™¨ä¸­å¸¸ç”¨çš„è¡¨æƒ…ç¬¦å·åˆ—è¡¨ã€‚</p>
    <p>æ­¤ API ä¼šæ›´æ–°å…¨å±€é…ç½® <code>conf.Editor.Emoji</code> çš„å€¼å¹¶ä¿å­˜ã€‚æˆåŠŸåä¼šå¹¿æ’­ <code>setEmoji</code> äº‹ä»¶é€šçŸ¥ UI æ›´æ–°ã€‚</p>
    <p><span class="warning">è¯¥ API éœ€è¦è¿›è¡Œèº«ä»½éªŒè¯ï¼Œè¯·åœ¨è¯·æ±‚å¤´ä¸­åŒ…å« <code>Authorization</code> å­—æ®µï¼Œå¹¶ç¡®ä¿ç”¨æˆ·è§’è‰²ä¸ºç®¡ç†å‘˜ä¸”éåªè¯»æ¨¡å¼ã€‚</span></p>
    <h2>è¯·æ±‚</h2>
    <p><code>POST</code></p>
    <h3>å‚æ•° (JSON Body)</h3>
    <ul>
        <li><code>emojis</code>: <code>array</code> of <code>string</code> (å¿…éœ€) - ä¸€ä¸ªåŒ…å«å¸¸ç”¨è¡¨æƒ…å­—ç¬¦çš„å­—ç¬¦ä¸²æ•°ç»„ã€‚ä¾‹å¦‚ï¼š<code>["ğŸ˜€", "ğŸ‰", "ğŸ‘"]</code>ã€‚</li>
    </ul>
    <div class="language-json HIDE">
    <pre class="highlight"><code><span class="p">{</span>
    <span class="nt">"emojis"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"ğŸ˜€"</span><span class="p">,</span> <span class="s2">"ğŸ‰"</span><span class="p">,</span> <span class="s2">"ğŸ‘"</span><span class="p">,</span> <span class="s2">"ğŸ’¡"</span><span class="p">]</span>
<span class="p">}</span>
</code></pre>
    </div>
    <h3>ç¤ºä¾‹ CURL</h3>
    <div class="language-shell HIDE">
    <pre class="highlight"><code>curl -X POST -H "Content-Type: application/json" -H "Authorization: Token YOUR_API_TOKEN" -d '{
    "emojis": ["ğŸ˜€", "ğŸ‰", "ğŸ‘", "ğŸ’¡"]
}' http://127.0.0.1:6806/api/setting/setEmoji
</code></pre>
    </div>
    <h2>å“åº”</h2>
    <p>æ“ä½œæˆåŠŸæ—¶ï¼Œé€šå¸¸è¿”å›å¦‚ä¸‹ï¼š</p>
    <div class="language-json HIDE">
    <pre class="highlight"><code><span class="p">{</span>
    <span class="nt">"code"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nt">"msg"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
    <span class="nt">"data"</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>
</code></pre>
    </div>
    <p>å¦‚æœæ“ä½œå¤±è´¥ï¼Œ<code>code</code> å°†æ˜¯éé›¶å€¼ï¼Œ<code>msg</code> ä¸­ä¼šåŒ…å«é”™è¯¯ä¿¡æ¯ã€‚</p>

    <h2>åœ¨çº¿æµ‹è¯•</h2>
    <p>
        <label>API Token: (ä»æ€æº"è®¾ç½®-å…³äº"ä¸­è·å–)<br>
            <input type="text" id="apiTokenInput" style="width: 100%;" placeholder="ç²˜è´´ä½ çš„ API Token">
        </label>
    </p>
    <p>
        <label>å¸¸ç”¨è¡¨æƒ… (emojis - JSON å­—ç¬¦ä¸²æ•°ç»„, ä¾‹å¦‚: <code>["ğŸ˜€", "âœ¨"]</code>):<br>
            <textarea id="requestEmojis" rows="3" style="width: 100%;">["ğŸ˜€", "ğŸ‰", "ğŸ‘", "ğŸ’¡", "ğŸ˜Š", "ğŸ¤”"]</textarea>
        </label>
    </p>
    <p><button onclick="loadCurrentEmojis()">ä» /api/system/getConf åŠ è½½å½“å‰è¡¨æƒ…</button> <button onclick="testAPI()">å‘é€è¯·æ±‚</button></p>
    <p><label>å“åº”:<br><textarea id="responseArea" rows="8" style="width: 100%;" readonly></textarea></label></p>
</div>
<script>
    let currentToken = localStorage.getItem('siyuanUserToken') || '';
    if (currentToken) {
        document.getElementById('apiTokenInput').value = currentToken;
    }

    document.getElementById('apiTokenInput').addEventListener('input', (event) => {
        currentToken = event.target.value;
        localStorage.setItem('siyuanUserToken', currentToken);
    });

    function getToken() {
        const storedToken = localStorage.getItem('siyuanUserToken');
        const inputToken = document.getElementById('apiTokenInput').value;
        if (inputToken && inputToken !== storedToken) {
            localStorage.setItem('siyuanUserToken', inputToken);
            return inputToken;
        }
        return storedToken || inputToken;
    }
    
    async function loadCurrentEmojis() {
        const token = getToken();
        if (!token) {
            document.getElementById('responseArea').value = 'é”™è¯¯ï¼šè¯·å…ˆæä¾› API Tokenã€‚';
            return;
        }
        try {
            const response = await fetch('/api/system/getConf', {
                method: 'POST',
                headers: {
                    'Authorization': 'Token ' + token,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({}) 
            });
            const data = await response.json();
            if (data.code === 0 && data.data && data.data.conf && data.data.conf.editor && data.data.conf.editor.emoji) {
                document.getElementById('requestEmojis').value = JSON.stringify(data.data.conf.editor.emoji, null, 2);
                document.getElementById('responseArea').value = 'å½“å‰å¸¸ç”¨è¡¨æƒ…å·²åŠ è½½ã€‚';
            } else {
                document.getElementById('requestEmojis').value = '[]'; // Fallback to empty array
                document.getElementById('responseArea').value = 'åŠ è½½å½“å‰è¡¨æƒ…å¤±è´¥æˆ–æœªè®¾ç½®: ' + JSON.stringify(data, null, 2);
            }
        } catch (error) {
            document.getElementById('responseArea').value = 'åŠ è½½é…ç½®è¯·æ±‚å¤±è´¥: ' + error;
        }
    }

    async function testAPI() {
        const token = getToken();
        if (!token) {
            document.getElementById('responseArea').value = 'é”™è¯¯ï¼šAPI Token æœªè®¾ç½®ã€‚';
            return;
        }

        const emojisStr = document.getElementById('requestEmojis').value;
        let parsedEmojis;
        try {
            parsedEmojis = JSON.parse(emojisStr);
            if (!Array.isArray(parsedEmojis) || !parsedEmojis.every(item => typeof item === 'string')) {
                document.getElementById('responseArea').value = 'é”™è¯¯ï¼šemojis å¿…é¡»æ˜¯ä¸€ä¸ª JSON å­—ç¬¦ä¸²æ•°ç»„ã€‚ä¾‹å¦‚ï¼š["ğŸ˜€", "âœ¨"]';
                return;
            }
        } catch (e) {
            document.getElementById('responseArea').value = 'é”™è¯¯ï¼šè¯·æ±‚çš„ emojis ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ•°ç»„ã€‚\n' + e;
            return;
        }

        const requestBody = { emojis: parsedEmojis };

        try {
            const response = await fetch('/api/setting/setEmoji', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Token ' + token
                },
                body: JSON.stringify(requestBody)
            });
            const data = await response.json();
            document.getElementById('responseArea').value = JSON.stringify(data, null, 2);
            if(data.code === 0) {
                alert("å¸¸ç”¨è¡¨æƒ…å·²æ›´æ–°ï¼");
            }
        } catch (error) {
            document.getElementById('responseArea').value = 'è¯·æ±‚å¤±è´¥ï¼š\n' + error;
        }
    }
</script>
<script src="../style.js?20231218"></script>
</body>
</html> 