<!DOCTYPE html>
<html>
<head>
<title>uninstallBazaarPlugin API</title>
<meta charset="utf-8">
<link rel="stylesheet" href="../github-markdown.css">
<link rel="stylesheet" href="../styles.css">
<style>
    .markdown-body { box-sizing: border-box; min-width: 200px; max-width: 980px; margin: 0 auto; padding: 45px; }
    @media (max-width: 767px) { .markdown-body { padding: 15px; } }
    .package-list { list-style: none; padding-left: 0; }
    .package-item { margin-bottom: 1em; border: 1px solid #eee; padding: 1em; }
    .package-item h4 { margin-top: 0; }
    .copy-button { position: absolute; top: 0.5em; right: 0.5em; padding: 0.3em 0.6em; font-size: 0.8em; background-color: #eee; border: 1px solid #ccc; border-radius: 3px; cursor: pointer; }
    .copy-button:hover { background-color: #ddd; }
    pre { position: relative; }
    .usage-examples { margin-top: 2em; border-top: 1px solid #eee; padding-top: 1em; }
    .usage-examples h3 { margin-bottom: 0.5em; }
    .usage-examples ul { list-style: disc; margin-left: 2em; }
    /* ä¸¥é‡é£é™©æç¤ºæ ·å¼ - çº¢è‰² */
    .critical-warning { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 0.75rem 1.25rem; margin-bottom: 1rem; border-radius: 0.25rem; }
    .critical-warning strong { font-weight: bold; }
</style>
</head>
<body class="markdown-body">
<blockquote>
<p>æœ¬æ–‡æ¡£éå®˜æ–¹å‡ºå“ï¼Œä¸»è¦ç”± AI è¾…åŠ©ç¼–å†™ï¼Œä¸ä¿è¯ç»å¯¹å‡†ç¡®ã€‚å¦‚æœ‰ç–‘é—®ï¼Œè¯·ä»¥ <a href="https://github.com/siyuan-note/siyuan/blob/master/kernel/api/bazaar.go">kernel/api/bazaar.go</a> ä¸­çš„æºç ä¸ºå‡†ã€‚</p>
<p>å¦‚æœæ‚¨è§‰å¾—æœ¬æ–‡æ¡£æœ‰å¸®åŠ©ï¼Œå¯ä»¥è€ƒè™‘èµåŠ©æ”¯æŒï¼š<a href="https://afdian.com/a/leolee9086?tab=feed">çˆ±å‘ç”µ</a></p>
</blockquote>
<h1>uninstallBazaarPlugin</h1>
<p>å¸è½½æŒ‡å®šçš„æ’ä»¶ã€‚</p>
<p><strong>æ–°æ‰‹æç¤ºï¼š</strong> è¿™ä¸ª API å°±æ˜¯ä½ åœ¨æ€æºæ’ä»¶ç®¡ç†ç•Œé¢ç‚¹å‡»"å¸è½½"æŒ‰é’®æ—¶èƒŒåæ‰§è¡Œçš„æ“ä½œã€‚</p>
<div class="critical-warning">
    <p><strong>ğŸš¨ğŸš¨ğŸš¨ æåº¦ä¸¥é‡è­¦å‘Šï¼šä»£ç å’Œæ–‡ä»¶åˆ é™¤æ“ä½œï¼ ğŸš¨ğŸš¨ğŸš¨</strong></p>
    <ul>
        <li>æ­¤æ“ä½œå°†**æ°¸ä¹…åˆ é™¤**æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ’ä»¶æ–‡ä»¶å¤¹ (`data/plugins/`) åŠå…¶åŒ…å«çš„æ‰€æœ‰ä»£ç å’Œæ•°æ®ï¼</li>
        <li><strong>è¯·åŠ¡å¿…å†ä¸‰ç¡®è®¤ä½ è¦å¸è½½çš„æ˜¯æ­£ç¡®çš„æ’ä»¶ï¼ä¸€æ—¦åˆ é™¤ï¼Œæ— æ³•æ¢å¤ï¼</strong></li>
        <li>å¸è½½æ’ä»¶ä¼šç§»é™¤å…¶æ‰€æœ‰åŠŸèƒ½ã€‚å¦‚æœå…¶ä»–æ’ä»¶æˆ–ä½ çš„å·¥ä½œæµä¾èµ–æ­¤æ’ä»¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´é”™è¯¯æˆ–æ•°æ®å¤„ç†ä¸­æ–­ï¼</li>
        <li>éœ€è¦**ç®¡ç†å‘˜æƒé™**å¹¶ä¸”ä¸èƒ½åœ¨**åªè¯»æ¨¡å¼**ä¸‹è¿è¡Œã€‚</li>
        <li>å¸è½½è¿‡ç¨‹å¯èƒ½å› æ–‡ä»¶æƒé™ç­‰é—®é¢˜å¤±è´¥ã€‚</li>
    </ul>
    <p><strong>é™¤éä½  100% æ¸…æ¥šåæœï¼Œå¦åˆ™ç»å¯¹ä¸è¦æ‰§è¡Œæ­¤æ“ä½œï¼</strong></p>
</div>
<p><strong>æ³¨æ„</strong>: æ­¤ API éœ€è¦è®¤è¯ã€ç®¡ç†å‘˜æƒé™ä¸”éåªè¯»æ¨¡å¼ã€‚</p>
<h2>åœ°å€</h2>
<p><code>POST /api/bazaar/uninstallBazaarPlugin</code></p>
<h2>è¯·æ±‚ä½“ (JSON)</h2>
<pre><code class="language-json">{
  "packageName": "è¦å¸è½½çš„æ’ä»¶åç§°",
  "frontend": "é€‚ç”¨çš„å‰ç«¯ (å¦‚ desktop)",
  "keyword": "å¯é€‰çš„å…³é”®è¯"
}
</code></pre>
<ul>
<li><code>packageName</code>: (<code>string</code>) å¿…å¡«ã€‚è¦å¸è½½çš„æ’ä»¶çš„åç§°ã€‚é€šå¸¸ä» <code>getInstalledPlugin</code> API è·å–ã€‚</li>
<li><code>frontend</code>: (<code>string</code>) å¿…å¡«ã€‚éœ€è¦æŒ‡å®šå‰ç«¯ï¼Œä¾‹å¦‚ <code>"desktop"</code> æˆ– <code>"mobile"</code>ã€‚ç”¨äºå¸è½½æˆåŠŸååˆ·æ–°å¯¹åº”å‰ç«¯çš„æ’ä»¶åˆ—è¡¨ã€‚</li>
<li><code>keyword</code>: (<code>string</code>) å¯é€‰ã€‚ç”¨äºå¸è½½æˆåŠŸååˆ·æ–°é›†å¸‚æ’ä»¶åˆ—è¡¨æ—¶çš„è¿‡æ»¤ã€‚å¯ä»¥ç•™ç©ºã€‚</li>
</ul>
<h2>å“åº”ä½“ (JSON)</h2>
<p>å¸è½½è¯·æ±‚æˆåŠŸåï¼Œè¿”å›æ ‡å‡†å“åº”ä½“ï¼Œ`data` å­—æ®µåŒ…å«åˆ·æ–°åçš„é›†å¸‚æ’ä»¶åˆ—è¡¨ã€‚</p>
<pre><code class="language-json">{
  "code": 0, // 0 è¡¨ç¤ºå¸è½½æˆåŠŸ
  "msg": "", // æˆåŠŸæ—¶ä¸ºç©ºï¼Œå¤±è´¥æ—¶åŒ…å«é”™è¯¯ä¿¡æ¯
  "data": {
    "packages": [
      // å¸è½½ååˆ·æ–°å¾—åˆ°çš„ *æ‰€æœ‰* é›†å¸‚å¯ç”¨æ’ä»¶åˆ—è¡¨ (é’ˆå¯¹æŒ‡å®š frontend å’Œ keyword)...
      // (ç»“æ„åŒ getBazaarPlugin è¿”å›çš„ packages)
    ]
  }
}
</code></pre>
<p><strong>æ³¨æ„:</strong></p>
<ul>
    <li>å¦‚æœå¸è½½å¤±è´¥ (ä¾‹å¦‚ï¼Œæ’ä»¶ä¸å­˜åœ¨æˆ–æ–‡ä»¶åˆ é™¤å¤±è´¥)ï¼Œ<code>code</code> ä¼šæ˜¯é 0 å€¼ï¼Œ<code>msg</code> ä¼šåŒ…å«é”™è¯¯ä¿¡æ¯ã€‚</li>
    <li>æˆåŠŸå¸è½½åï¼Œæ’ä»¶çš„åŠŸèƒ½å°†å®Œå…¨æ¶ˆå¤±ã€‚é€šå¸¸éœ€è¦é‡å¯æ€æºæˆ–è‡³å°‘é‡æ–°åŠ è½½ç•Œé¢æ‰èƒ½å®Œå…¨ç§»é™¤æ’ä»¶çš„å½±å“ã€‚</li>
</ul>
<h2>ç¤ºä¾‹</h2>
<div style="position: relative;">
<pre id="example-fetch-code"><code class="language-javascript">// å‡è®¾è¦å¸è½½åä¸º "sample-plugin" çš„æ’ä»¶
const pkgName = "sample-plugin";
const targetFrontend = "desktop";

// **!!! æ ¸è­¦å‘Šï¼šæ‰§è¡Œæ­¤ä»£ç ä¼šå®é™…åˆ é™¤æ’ä»¶ä»£ç å’Œæ–‡ä»¶ !!!**
// **!!! è¯·ç¡®ä¿ä½ ç†è§£å…¨éƒ¨é£é™©å¹¶å·²å¤‡ä»½æ•°æ® !!!**

// ç¤ºä¾‹ï¼šæ·»åŠ å¤šé‡ç¡®è®¤
if (prompt(`é£é™©æ“ä½œç¡®è®¤ï¼šè¯·è¾“å…¥è¦å¸è½½çš„æ’ä»¶åç§° "${pkgName}" ä»¥ç»§ç»­ã€‚`) === pkgName) {
  if (confirm(`ã€æœ€ç»ˆè­¦å‘Šã€‘å³å°†æ°¸ä¹…åˆ é™¤æ’ä»¶ "${pkgName}" çš„æ‰€æœ‰æ–‡ä»¶ï¼\n\nç¡®å®šå—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼`)) {
    fetch('/api/bazaar/uninstallBazaarPlugin', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Token YOUR_API_TOKEN' // æ›¿æ¢ä¸ºä½ çš„ç®¡ç†å‘˜ API Token
      },
      body: JSON.stringify({
        packageName: pkgName,
        frontend: targetFrontend,
        keyword: ""
      })
    })
    .then(response => response.json())
    .then(data => {
      if (data.code === 0) {
        console.log(`æ’ä»¶ "${pkgName}" å¸è½½æˆåŠŸã€‚`);
        // å¯èƒ½éœ€è¦æç¤ºç”¨æˆ·é‡å¯æ€æº
      } else {
        console.error(`æ’ä»¶ "${pkgName}" å¸è½½å¤±è´¥:`, data.msg);
      }
    })
    .catch(error => console.error('è¯·æ±‚é”™è¯¯:', error));
  } else {
    console.log('å–æ¶ˆå¸è½½æ“ä½œã€‚');
  }
} else {
  console.log('æ’ä»¶åç§°è¾“å…¥é”™è¯¯æˆ–å–æ¶ˆå¸è½½æ“ä½œã€‚');
}
</code></pre>
<button class="copy-button" onclick="copyCode('example-fetch-code')">å¤åˆ¶</button>
</div>

<!-- åœ¨çº¿æµ‹è¯•åŒºåŸŸ -->
<div class="test-area">
    <h3>åœ¨çº¿æµ‹è¯•</h3>
    <p>ä½ éœ€è¦å…ˆé€šè¿‡ <code>getInstalledPlugin</code> è·å–åˆ°ä¸€ä¸ªå·²å®‰è£…æ’ä»¶çš„ <code>packageName</code> æ‰èƒ½æµ‹è¯•æ­¤æ¥å£ã€‚</p>
    <div class="critical-warning"><strong>â˜¢ï¸â˜¢ï¸â˜¢ï¸ æ ¸æ­¦å™¨çº§åˆ«å±é™©ï¼šåˆ é™¤ä»£ç å’Œæ–‡ä»¶ï¼ â˜¢ï¸â˜¢ï¸â˜¢ï¸</strong> åœ¨æ­¤æµ‹è¯•ä¼šå®é™…æ°¸ä¹…åˆ é™¤ä½ æœ¬åœ°çš„æ’ä»¶æ–‡ä»¶å¤¹ï¼è¯·<strong>åå¤æ ¸å¯¹æ’ä»¶åç§°</strong>ï¼<strong>é™¤éä½ å®Œå…¨ç†è§£å¹¶æ¥å—æ‰€æœ‰æ½œåœ¨çš„æ•°æ®ä¸¢å¤±å’Œç³»ç»Ÿé£é™©ï¼Œå¦åˆ™åˆ‡å‹¿ç‚¹å‡»å‘é€æŒ‰é’®ï¼</strong></div>
    <form id="api-test-form-uninstall">
        <div class="form-group">
            <label for="api-token">API Token (ç®¡ç†å‘˜):</label>
            <input type="text" id="api-token" placeholder="éœ€è¦ç®¡ç†å‘˜æƒé™çš„Token">
        </div>
        <div class="form-group">
            <label for="api-endpoint">æ¥å£åœ°å€:</label>
            <input type="text" id="api-endpoint" value="http://127.0.0.1:6806/api/bazaar/uninstallBazaarPlugin">
        </div>
        <div class="form-group">
            <label for="api-method">è¯·æ±‚æ–¹æ³•:</label>
            <input type="text" id="api-method" value="POST" readonly>
        </div>
        <div class="form-group">
            <label for="api-params">è¯·æ±‚å‚æ•° (JSON):</label>
            <textarea id="api-params">{
  "packageName": "è¾“å…¥è¦å¸è½½çš„æ’ä»¶åç§°!",
  "frontend": "desktop",
  "keyword": ""
}</textarea>
        </div>
        <button type="submit" class="btn" style="background-color: #dc3545; color: white; font-weight: bold; border: 2px solid darkred;">å‘é€å¸è½½è¯·æ±‚ (åæœè‡ªè´Ÿ!)</button>
    </form>
    <div id="api-result" class="result"></div>
</div>

<!-- å®é™…åº”ç”¨æ¡ˆä¾‹ -->
<div class="usage-examples">
    <h3>å®é™…åº”ç”¨æ¡ˆä¾‹ / Who Uses This API?</h3>
    <p>å¦‚æœä½ çš„å¤–éƒ¨å·¥å…·ä½¿ç”¨äº†è¿™ä¸ª API æ¥ç®¡ç†æ’ä»¶å¸è½½ï¼Œæ¬¢è¿æäº¤ Pull Request å°†ä½ çš„é¡¹ç›®æ·»åŠ åˆ°ä¸‹æ–¹åˆ—è¡¨ï¼</p>
    <ul>
        <li>æš‚æ—  ï¼ˆæœŸå¾…ä½ çš„è´¡çŒ®ï¼ï¼‰</li>
    </ul>
</div>

<script src="../api-tester.js"></script>
<script>
// å¤åˆ¶æŒ‰é’®çš„ JavaScript å‡½æ•°
function copyCode(elementId) {
    const codeElement = document.getElementById(elementId);
    if (codeElement) {
        const code = codeElement.textContent || codeElement.innerText;
        navigator.clipboard.writeText(code).then(() => {
            const button = codeElement.nextElementSibling;
            if (button && button.classList.contains('copy-button')) {
                const originalText = button.textContent;
                button.textContent = 'å·²å¤åˆ¶!';
                setTimeout(() => { button.textContent = originalText; }, 2000);
            }
        }).catch(err => {
            console.error('å¤åˆ¶å¤±è´¥:', err);
        });
    }
}

// ä¸ºå¸è½½æ“ä½œçš„åœ¨çº¿æµ‹è¯•è¡¨å•æ·»åŠ æäº¤äº‹ä»¶ç›‘å¬å™¨
document.getElementById('api-test-form-uninstall').addEventListener('submit', function(event) {
    event.preventDefault(); // é˜»æ­¢è¡¨å•é»˜è®¤æäº¤è¡Œä¸º

    const token = document.getElementById('api-token').value;
    const endpoint = document.getElementById('api-endpoint').value;
    const method = document.getElementById('api-method').value;
    const paramsText = document.getElementById('api-params').value;
    const resultDiv = document.getElementById('api-result');

    let params;
    try {
        params = JSON.parse(paramsText);
    } catch (e) {
        resultDiv.textContent = 'è¯·æ±‚å‚æ•° JSON æ ¼å¼é”™è¯¯: ' + e.message;
        resultDiv.className = 'result error';
        return;
    }

    const packageName = params.packageName || '[æœªæŒ‡å®šåŒ…å]';
    const frontend = params.frontend || '[æœªæŒ‡å®šå‰ç«¯]';

    // --- å¤šé‡ç¡®è®¤ (å¢åŠ è¾“å…¥ç¡®è®¤) --- 
    const confirmName = prompt(`ã€æœ€é«˜é£é™©ç¡®è®¤ã€‘è¯·è¾“å…¥ä½ è¦æ°¸ä¹…åˆ é™¤çš„æ’ä»¶çš„å‡†ç¡®åç§°ï¼š"${packageName}"`);
    if (confirmName !== packageName) {
        resultDiv.textContent = `æ’ä»¶åç§°è¾“å…¥é”™è¯¯æˆ–å–æ¶ˆæ“ä½œã€‚éœ€è¦è¾“å…¥ï¼š"${packageName}"ï¼Œå®é™…è¾“å…¥ï¼š"${confirmName || ''}"`;
        resultDiv.className = 'result error';
        return;
    }
    
    if (!confirm(`ã€æœ€ç»ˆè­¦å‘Š - ${packageName}ã€‘å³å°†æ°¸ä¹…åˆ é™¤æ­¤æ’ä»¶çš„æ‰€æœ‰æ–‡ä»¶å’Œä»£ç ï¼\n\nå±äºå‰ç«¯ï¼š"${frontend}"ã€‚\n\nç¡®å®šå—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼Œä¸”å¯èƒ½å¯¼è‡´ä¸¥é‡åæœï¼`)) {
        resultDiv.textContent = 'ç”¨æˆ·å–æ¶ˆæ“ä½œã€‚';
        resultDiv.className = 'result info';
        return;
    }
    // --- ç¡®è®¤ç»“æŸ ---

    resultDiv.textContent = 'æ­£åœ¨å‘é€è¯·æ±‚...';
    resultDiv.className = 'result info';

    fetchAPI(endpoint, method, token, paramsText, resultDiv);
});

</script>

</body>
</html> 